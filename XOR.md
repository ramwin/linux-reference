# XOR缓存：压缩的催化剂

&gt; 作者：潘哲文，Joshua San Miguel  
&gt; 机构：威斯康星大学麦迪逊分校  
&gt; 会议：ISCA 2025，日本东京  
&gt; 邮箱：zhewen.pan@wisc.edu

---

## 摘要

现代计算系统为缓存分配了大量资源，尤其是末级缓存（LLC）。我们观察到，通过利用当今系统中常见的私有缓存和包含机制带来的冗余，存在尚未开发的压缩潜力。

我们引入了 **XOR缓存**，通过 **XOR压缩** 来利用这种冗余。与传统的缓存架构不同，XOR缓存存储的是缓存行对的按位异或值，通过一种**行间压缩**的形式，将存储的行数减半。当与其他压缩方案结合使用时，XOR缓存可以通过对值相近的行进行异或运算，从而降低压缩前数据的熵，进一步提高**行内压缩率**。

评估结果表明，与更大的未压缩缓存相比，XOR缓存可以节省 **1.93倍的LLC面积** 和 **1.92倍的功耗**，性能开销为 **2.06%**，同时能量延迟积降低。

---

## 关键词

缓存层次结构、缓存压缩、低功耗架构

---

## 1 引言

当今的计算系统将数十到数百MB的SRAM专用于缓存，这占据了芯片面积的很大一部分。例如，AMD的Zen3的32MB L3缓存占据了芯片面积的约40%。此外，这些系统的功耗也会激增，进一步降低了整体能效。

由于数据集大小的增长和内存墙问题，对缓存层次结构中的资源需求将继续增加。然而，尽管容量更大，大型缓存并不一定意味着更好的性能；此外，它们的代价是**高访问延迟**，通常为数十个周期。

鉴于其对资源的要求，这些因素加在一起可能使传统的大型缓存在未来的系统中效率低下。为了弥补这种效率差距，我们寻求更好的方法来优化缓存层次结构，在保持性能的同时减少缓存占用空间和功耗。

---

## 缓存压缩的潜力

缓存压缩是一项颇具前景的研究方向。缓存可以在插入时压缩缓存行，并在访问时解压缩。这种方法减少了缓存占用，而访问延迟的开销仅为几个额外的周期。有效的缓存压缩利用数据压缩性，在显著降低硬件成本的同时，实现了更大缓存的优势。

---

## XOR缓存的核心理念

我们介绍了 **XOR缓存**，这是一种新的压缩LLC架构，它利用了当今系统内存层次结构所固有的跨多个缓存的冗余。具体而言，XOR缓存利用了以下两种冗余：

1. **由于包含机制带来的冗余**：在包含式缓存层次结构中，高级缓存中的数据通常也会在低级缓存中重复出现。
2. **由于私有缓存带来的冗余**：私有缓存之间通过一致性协议进行数据转发，也会带来重复数据。

XOR缓存将曾经被认为是缺点的东西（由于包含而导致的冗余）转化为**尚未开发的可压缩性**。

---

## 图1：XOR缓存概览

- 传统缓存：按原样存储缓存行。
- XOR缓存：存储两个缓存行的按位异或结果（A⊕B），实现 2:1 的压缩率。

在LLC访问中，可以将异或后的行 A⊕B 转发到较高层级，并执行另一个异或运算来恢复原始数据。

---

## XOR缓存的两个好处

1. **节省存储空间**：两行数据异或后只需存储一行。
2. **降低熵值**：当两行数据相似时，异或后的数据熵更低，更容易被压缩，提升其他压缩方案的效果。

---

## 研究目标

本研究的目标是利用XOR缓存带来的增强压缩性来减少LLC的面积和功耗。

---

## 2 背景

### 2.1 现代缓存层次结构

缓存层次结构通常分为包含式、非包含非排他式（NINE）和排他式。包含式缓存中，高级缓存必须包含低级缓存中的所有数据，这会导致冗余。

### 2.2 缓存一致性

LLC通常是系统中的一致性点，需要目录结构来维护一致性状态，如共享者列表、所有者等。XOR缓存需要精确的共享者信息以确保数据可恢复。

### 2.3 低功耗缓存架构

已有研究探索了多种降低缓存功耗的方法，包括动态关闭死块、低功耗休眠状态、缓存压缩等。压缩技术尤其有前景，它利用数据冗余实现压缩。

---

## 3 XOR压缩

### 3.1 压缩与解压缩算法

XOR缓存存储的是两个缓存行的按位异或结果。访问时，通过与其中一个原始行再次异或即可恢复另一行。压缩与解压缩过程对称，硬件实现简单，仅需512个异或门。

### 3.2 XOR策略：寻找XOR候选者

XOR策略决定哪些缓存行应进行异或操作。策略范围从随机选择到基于值相似性的智能选择。理想情况下，选择相似的行进行异或可以显著降低熵值，提升压缩率。

---

## 4 XOR缓存一致性协议

XOR缓存引入了新的一致性挑战，特别是在解压和恢复数据时。我们提出了一个基于MSI协议的扩展，支持：

- **压缩**：插入时尝试异或压缩。
- **解压缩**：访问异或行时，通过转发和异或恢复原始数据。
- **反异或**：在特定一致性事件下，必须恢复原始数据以避免不可恢复状态。

---

## 5 XOR缓存架构

### 5.1 存储组织

XOR缓存采用解耦的标签与数据存储，并使用映射表来识别异或候选。标签数组管理XOR指针，数据数组支持可变大小压缩块。

### 5.2 操作流程

包括读取、写入、写回、驱逐和插入等操作。插入时尝试寻找异或候选，若找到则进行异或压缩，否则按未压缩方式插入。

---

## 6 评估

### 6.1 方法

使用gem5模拟器，配置3级缓存层次结构，评估XOR缓存的压缩率、面积、功耗和性能开销。

### 6.2 压缩率

XOR缓存与BΔI结合使用时，平均压缩比为2.5，显著优于BΔI、BPC、Thesaurus等方案。

### 6.3 面积与功耗

XOR缓存的LLC面积比未压缩缓存小1.93倍，功耗降低1.92倍，整体缓存层次功耗降低1.46倍。

### 6.4 性能开销

平均性能开销为2.06%，多线程下为1.45%，多程序下为2.95%。

### 6.5 能量延迟积（EDP）

XOR缓存的EDP比未压缩缓存低26.3%，在各项方案中最优。

---

## 7 相关工作

介绍了行间压缩、重复数据删除、近似缓存、对象压缩等相关研究，并指出XOR缓存的独特之处在于**利用包含冗余和私有缓存冗余**进行压缩。

---

## 8 结论

XOR缓存利用由于包含和私有缓存产生的数据冗余，同时实现行间和行内压缩。评估表明，XOR缓存显著减少了LLC面积和功耗，性能开销极小，是未来缓存架构的有力候选。

---
